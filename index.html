<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teacher Timetables</title>
  <style>
    body { font-family: sans-serif; margin: 1rem; background: #f5f7fa; }
    .teacher-card { 
      background: #fff; 
      border-radius: 8px; 
      box-shadow: 0 2px 6px rgba(0,0,0,.1); 
      margin-bottom: 2rem; 
      padding: 1rem; 
    }
    .teacher-card h2 { 
      margin: 0 0 1rem; 
      font-size: 1.25rem; 
    }
    table.schedule { 
      width: 100%; 
      border-collapse: collapse; 
      margin-bottom: 1rem; 
    }
    table.schedule th, 
    table.schedule td { 
      border: 1px solid #d0d7de; 
      padding: 4px; 
      text-align: center; 
    }
    table.schedule th { 
      background: #c6e0ff; 
      font-size: 0.85rem; 
    }
    table.schedule td { 
      min-height: 2.5rem; 
      background: #eef6fc; 
    }
    table.schedule td div { 
      font-size: 0.85rem; 
    }
  </style>
</head>
<body>

  <div id="schedules">Loading…</div>

  <script>
  (function(){
    const CONTAINER = document.getElementById("schedules");
    const DAY_ABBR  = ["Mo","Tu","We","Th","Fr"];
    const DAY_NAME  = { Mo:"Monday", Tu:"Tuesday", We:"Wednesday", Th:"Thursday", Fr:"Friday" };

    // ← Fetch your cleaned JSON (must live next to this index.html)
    fetch("teacher_schedules_clean.json")
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.json();
      })
      .then(teachers => {
        CONTAINER.innerHTML = "";  // clear “Loading…”
        const names = Object.keys(teachers);
        if (!names.length) {
          CONTAINER.innerHTML = "<p>No schedules found.</p>";
          return;
        }

        // Derive the 19 slot‐keys from the first teacher’s Mo row:
        const slots = Object.keys(teachers[names[0]].Mo);
        if (slots.length !== 19) {
          console.warn("Expected 19 slots, got", slots.length, slots);
        }

        // Render one card+table per teacher
        names.forEach(name => {
          const week = teachers[name];

          // CARD
          const card = document.createElement("div");
          card.className = "teacher-card";
          const h2 = document.createElement("h2");
          h2.textContent = `Nama Guru: ${name}`;
          card.appendChild(h2);

          // TABLE
          const tbl = document.createElement("table");
          tbl.className = "schedule";

          // HEADER
          const thead = tbl.createTHead();
          const hr = thead.insertRow();
          hr.insertCell().outerHTML = "<th>Day</th>";
          slots.forEach(slot => {
            // split on bare hyphen or en-dash
            const [start,end] = slot.split(/\s*[–-]\s*/);
            const s = start.padStart(5,"0");
            const e =   end.padStart(5,"0");
            const th = document.createElement("th");
            th.innerHTML = `${s}<br>–<br>${e}`;
            hr.appendChild(th);
          });

          // BODY
          const tbody = tbl.createTBody();
          DAY_ABBR.forEach(d => {
            const tr = tbody.insertRow();
            tr.insertCell().outerHTML = `<th>${DAY_NAME[d]}</th>`;

            slots.forEach(slot => {
              const td = tr.insertCell();
              const entries = (week[d] && week[d][slot]) || [];
              // *** map objects, not raw strings ***
              td.innerHTML = entries.map(e => {
                const parts = [];
                if (e.subject) parts.push(e.subject);
                if (e.class)   parts.push(e.class);
                if (e.venue)   parts.push(e.venue);
                return `<div>${parts.join(" ")}</div>`;
              }).join("");
            });
          });

          card.appendChild(tbl);
          CONTAINER.appendChild(card);
        });
      })
      .catch(err => {
        console.error(err);
        CONTAINER.innerHTML = `<p style="color:red">Error loading data: ${err.message}</p>`;
      });
  })();
  </script>

</body>
</html>