<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SMK Seri Pulai Perdana – Timetable Viewer</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* —— blue ASC-Timetables palette —— */
:root{
  --asc-blue: #dce9ff;      /* cell fill   */
  --asc-blue-dark:#007aff;  /* headings    */
  --asc-blue-header:#eaf3ff;
}
table.asc   { border-collapse:collapse; width:100% }
table.asc th, table.asc td{ border:1px solid #a6c8ff; padding:4px 6px; font-size:13px}
table.asc thead th{ background:var(--asc-blue-header); color:#000; font-weight:600 }
table.asc tbody th{ background:var(--asc-blue-dark); color:#fff; width:90px }
table.asc tbody td{ background:var(--asc-blue) }

.sticky-col{ position:sticky; left:0; z-index:1 }
.sticky-head th{ position:sticky; top:0; z-index:2 }
</style>
</head>
<body class="bg-gray-100 flex flex-col h-full text-gray-800">

<header class="p-6 bg-indigo-600 text-white text-center shadow">
  <h1 class="text-2xl font-semibold">SMK Seri Pulai Perdana – Timetable Viewer</h1>
  <p class="text-sm mt-1">Upload <em>Jadual_nama.pdf</em>, wait a moment, then scroll.</p>

  <form id="uploadForm" class="mt-4 flex items-center justify-center gap-3 flex-wrap">
    <input type="file" name="file" accept="application/pdf"
           class="text-sm file:mr-3 file:p-2 file:border-0 file:font-semibold file:bg-white file:text-indigo-700">
    <button class="px-4 py-2 bg-white text-indigo-700 font-semibold rounded shadow">
      Upload & View
    </button>
  </form>
  <div id="status" class="mt-2 text-sm"></div>
</header>

<main id="timetables" class="p-6 space-y-10 overflow-y-auto flex-1"></main>

<script>
/* —— simple cell cleanup —— */
function tidy(text){
  return (text||'').replace(/\s+/g,' ').trim();
}

function render(data){
  const root=document.getElementById('timetables');
  root.innerHTML='';
  data.forEach(t=>{
    const card=document.createElement('section');
    card.className='bg-white rounded-xl shadow overflow-hidden';
    const hdr=`<div class="bg-gray-50 px-6 py-4 border-b">
                 <h2 class="text-lg font-bold text-indigo-700">${t.teacher}</h2>
               </div>`;
    let tbl=`<div class="overflow-x-auto"><table class="asc"><thead class="sticky-head"><tr>
               <th class="sticky-col">Day</th>`;
    t.times.forEach(ts=>{ tbl+=`<th>${ts.replace('-',' - ')}</th>`; });
    tbl+='</tr></thead><tbody>';
    for(const [day,row] of Object.entries(t.schedule)){
      tbl+=`<tr><th class="sticky-col">${day}</th>`;
      row.forEach(cell=>{
        const txt=tidy(cell);
        tbl+=`<td>${txt.replace(/,?\s*([A-Z]{1,4})\s*/g,'<div>$1</div>')}</td>`;
      });
      tbl+='</tr>';
    }
    tbl+='</tbody></table></div>';
    card.innerHTML=hdr+tbl;
    root.appendChild(card);
  });
}

/* —— upload handler —— */
document.getElementById('uploadForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const f=e.target.file.files[0]; if(!f)return;
  const msg=document.getElementById('status'); msg.textContent='Processing…';
  const res=await fetch('/api/upload',{method:'POST',body:new FormData(e.target)});
  const data=await res.json();
  if(!res.ok){ msg.textContent='❌ '+(data.error||'unknown error'); return; }
  render(data); msg.textContent=`Loaded ${data.length} timetables.`;
});
</script>
</body>
</html>