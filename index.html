<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Teacher Timetables</title>

<style>
  /* ---- basic look --------------------------------------------------- */
  body      { font-family: Arial, Helvetica, sans-serif; margin: 0; background-color: #f4f7f6; }
  section   {
    padding: 20px;
    page-break-after: always;
    background-color: #ffffff;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    max-width: 90%; /* Responsive width */
    overflow-x: auto; /* Enable horizontal scrolling for tables on small screens */
  }
  h2        {
    margin: 0 0 20px; /* Increased margin for better spacing */
    font-size: 1.5rem; /* Larger font size for headers */
    color: #333;
    text-align: center;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 10px;
  }

  table     {
    border-collapse: collapse;
    width: 100%;
    min-width: 700px; /* Ensure table is wide enough for content */
  }
  th, td    {
    border: 1px solid #c9d6df; /* Softer border color */
    padding: 8px 12px; /* Increased padding */
    font-size: 0.85rem; /* Slightly larger font size for readability */
    text-align: center;
    word-wrap: break-word; /* Ensure long words break */
    white-space: normal; /* Allow text to wrap */
    vertical-align: top; /* Align content to the top of the cell */
  }
  th        {
    background: #dbe9f6; /* Lighter blue header */
    color: #3f51b5; /* Darker blue text */
    font-weight: 700;
    position: sticky;
    top: 0;
    z-index: 10; /* Keep headers visible on scroll */
  }
  td        {
    background: #eef5f9; /* Light yellow background */
    color: #4a4a4a;
  }
  td.day    {
    background: #b0d9f4; /* More prominent day column */
    font-weight: 600;
    width: 120px; /* Fixed width for day column */
    text-align: left;
    color: #1a237e; /* Dark blue for day names */
    position: sticky;
    left: 0;
    z-index: 5; /* Keep day column visible on horizontal scroll */
  }
  .rehat-cell { /* Added for styling REHAT cells */
      background-color: #e6ffed !important; /* Light green, !important to override default td bg */
      color: #28a745 !important;
      font-weight: bold;
  }
  /* Responsive adjustments */
  @media (max-width: 768px) {
    section {
      padding: 15px;
      margin: 15px auto;
      max-width: 95%;
    }
    h2 {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    th, td {
      padding: 6px 8px;
      font-size: 0.8rem;
    }
    td.day {
      min-width: 90px; /* Adjust day column width for mobile */
    }
  }

  @media print {
    body { margin: 0; }
    section {
      box-shadow: none;
      border: 1px solid #ccc;
      page-break-after: always; /* Ensure each teacher on a new page */
    }
  }
</style>
</head>
<body>

<div id="root" style="padding:20px; text-align: center;">Loading timetable …</div>

<script>
/* ─────────────────────────── constants ─────────────────────────────── */
const FULL  = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
const ABBR  = ["Mo","Tu","We","Th","Fr"];

// Hardcoded BLOCKS with desired display time ranges for headers
// These keys MUST match the keys used in your teacher_schedules.json
const BLOCKS_DISPLAY = [
  "07:15-07:45","07:45-08:15","08:15-08:45","08:45-09:15",
  "09:15-09:45","09:45-10:00",
  "09:45-10:15","10:00-10:30","10:15-10:30",
  "10:30-11:00","11:00-11:30","11:30-12:00","12:00-12:30",
  "12:30-13:00","13:00-13:30","13:30-14:00","14:00-14:30",
  "14:30-15:00","15:00-15:30"
];

/* ─────────────────── fetch + main render entry point ───────────────── */
fetch('teacher_schedules.json')
  .then(r => {
    if (!r.ok) {
      throw new Error(`HTTP error! status: ${r.status}`);
    }
    return r.json();
  })
  .then(data => {
    // Assuming 'data' is the root object from JSON_01.txt, which contains teacher names as keys.
    // If your teacher_schedules.json has a structure like { "teachers": { ... } },
    // you'd use data.teachers here. Based on JSON_01.txt, 'data' itself is the teachersDb.
    renderAll(data);
  })
  .catch(err => {
    const root = document.getElementById('root');
    root.innerHTML = `<div style="color: red; font-weight: bold; padding: 20px;">
                        ⚠ Error loading timetable: ${err.message}.<br>
                        Please ensure 'teacher_schedules.json' exists and is a valid JSON.
                      </div>`;
    console.error("Error loading timetable:", err);
  });

function renderAll(teachersDb){
  const root = document.getElementById('root');
  root.innerHTML = ''; 

  Object.entries(teachersDb).forEach(([name, teacherObj])=>{
      const sec = document.createElement('section');
      sec.innerHTML = `<h2>NAMA GURU: ${name}</h2>`; // Teacher names are already formatted in JSON
      sec.appendChild(buildTable(teacherObj));
      root.appendChild(sec);
  });
}

function buildTable(t){
  const hasAbbr = ABBR.some(k => k in t); 
  let tbl;
  if (hasAbbr) {
    tbl = fromAbbr(t);
  } else {
    tbl = document.createElement('div');
    tbl.textContent = '⚠ Unrecognised data format for this teacher.';
    tbl.style.color = 'orange';
    tbl.style.fontWeight = 'bold';
    tbl.style.textAlign = 'center';
    tbl.style.padding = '20px';
  }
  return tbl;
}

function headerRow(tbl, blocksToDisplay){
  const h = tbl.insertRow();
  h.insertCell().outerHTML = '<th>Day</th>';
  blocksToDisplay.forEach(b => {
    // Split the time range for display if needed, but use the full string as key
    // Example: "07:15-07:45" is displayed as is or split.
    // For display, make it more readable
    const parts = b.split('-');
    const displayTime = `${parts[0]}\n-\n${parts[1]}`; // Display on two lines for compactness
    h.insertCell().outerHTML = `<th>${displayTime.replace('\n','<br>')}</th>`; 
  });
}

// REVISED fromAbbr function
function fromAbbr(teacher){
  const tbl = document.createElement('table');
  headerRow(tbl, BLOCKS_DISPLAY); // BLOCKS_DISPLAY defines the column headers AND the keys to use for data

  FULL.forEach((dayName, dIdx) => {
      const tr = tbl.insertRow();
      tr.insertCell().outerHTML = `<td class="day">${dayName}</td>`;
      
      const dayData = teacher[ABBR[dIdx]] || {}; // e.g., teacher.Mo or teacher.Tu
      
      BLOCKS_DISPLAY.forEach(blockRangeKey => { // blockRangeKey is "07:15-07:45", "07:45-08:15", etc.
          
          const cellEntries = dayData[blockRangeKey]; // Directly use the blockRangeKey
          
          const td  = tr.insertCell();
          if (cellEntries && Array.isArray(cellEntries) && cellEntries.length > 0) {
              if (cellEntries.length > 1) {
                const ul = document.createElement('ul');
                ul.style.listStyle = 'none';
                ul.style.padding = '0';
                ul.style.margin = '0';
                ul.style.textAlign = 'center'; // Center list items if desired
                cellEntries.forEach(entry => {
                    const li = document.createElement('li');
                    li.textContent = entry;
                    ul.appendChild(li);
                });
                td.appendChild(ul);
              } else {
                td.textContent = cellEntries[0]; 
              }
              if (cellEntries.some(entry => typeof entry === 'string' && entry.toUpperCase().includes("REHAT"))) {
                td.classList.add('rehat-cell'); 
              }
          } else if (cellEntries && !Array.isArray(cellEntries)) { // Fallback if not an array
              td.textContent = cellEntries;
              if (typeof cellEntries === 'string' && cellEntries.toUpperCase().includes("REHAT")) {
                td.classList.add('rehat-cell');
              }
          }
          // else: cell remains empty
      });
  });
  return tbl;
}

// fromDays and fromRows functions are kept for schema compatibility (not used with current JSON)
function fromDays(blocks, days){
  const tbl = document.createElement('table');
  headerRow(tbl, blocks);
  FULL.forEach(dayName => {
      const tr = tbl.insertRow();
      tr.insertCell().outerHTML = `<td class="day">${dayName}</td>`;
      (days[dayName] || []).forEach(cell=>{
          const td = tr.insertCell();
          if (cell) td.textContent = cell;
      });
  });
  return tbl;
}
function fromRows(blocks, rows, titles){
  const tbl = document.createElement('table');
  headerRow(tbl, blocks);
  const label = rows.length === 5 ? FULL : titles;
  rows.forEach((row, idx) => {
      const tr = tbl.insertRow();
      tr.insertCell().outerHTML =
          `<td class="day">${label[idx] || 'Row '+(idx+1)}</td>`;
      row.forEach(c=>{
          const td = tr.insertCell();
          if (c) td.textContent = c;
      });
  });
  return tbl;
}
</script>
</body>
</html>