<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teacher Timetables</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:1rem;background:#f5f7fa}
    .teacher-card{background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:2rem;padding:1rem}
    .teacher-card h2{margin:0 0 1rem;font-size:1.25rem}
    table.schedule{width:100%;border-collapse:collapse;margin-bottom:1rem}
    table.schedule th,table.schedule td{border:1px solid #d0d7de;padding:4px;text-align:center}
    table.schedule th{background:#c6e0ff;font-size:.85rem}
    table.schedule td{background:#eef6fc;height:2.5rem}
    table.schedule td div{font-size:.85rem;line-height:1.15}
  </style>
</head>
<body>
  <div id="schedules">Loading…</div>

  <script>
  (function () {
    const CONTAINER = document.getElementById('schedules');
    const FULL_DAYS = ['Monday','Tuesday','Wednesday','Thursday','Friday'];
    const DAY_ABBR  = ['Mo','Tu','We','Th','Fr'];
    const DAY_NAME  = {Mo:'Monday',Tu:'Tuesday',We:'Wednesday',Th:'Thursday',Fr:'Friday'};

    // words we always strip if they appear alone
    const HONORIFICS = new Set(['EN','PN','PUAN','TUAN','CIK','DR','UST','USTAZ','USTAZAH']);

    /** Return true when token looks like a teacher’s name or honorific */
    function isTeacherToken(tok, teacherTokens) {
      const clean = tok.replace(/[^A-Z]/gi,'').toUpperCase();
      if (!clean) return true;            // strip punctuation-only tokens
      if (HONORIFICS.has(clean)) return true;
      return teacherTokens.has(clean);    // one of the teacher’s own name parts
    }

    fetch('teacher_schedules.json')
      .then(r => (r.ok ? r.json() : Promise.reject(new Error(`HTTP ${r.status}`))))
      .then(data => {
        CONTAINER.innerHTML = '';                                 // clear “Loading…”
        const teachers = data;
        const teacherNames = Object.keys(teachers);
        if (!teacherNames.length) {
          CONTAINER.textContent = 'No schedules found.';
          return;
        }

        // derive slot list from first teacher
        const slots = Object.keys(teachers[teacherNames[0]].Mo);

        teacherNames.forEach(name => {
          const week = teachers[name];

          // build a fast-lookup set of this teacher’s own name parts
          const teacherTokens = new Set(
            name.split(/\s+/).map(t => t.replace(/[^A-Z]/gi,'').toUpperCase())
          );

          // card wrapper
          const card = document.createElement('div');
          card.className = 'teacher-card';

          // title
          const h2 = document.createElement('h2');
          h2.textContent = `Nama Guru: ${name}`;
          card.appendChild(h2);

          // timetable
          const tbl = document.createElement('table');
          tbl.className = 'schedule';

          // header row
          const thead = tbl.createTHead();
          const hr = thead.insertRow();
          hr.insertCell().outerHTML = '<th>Day</th>';
          slots.forEach(slot => {
            const [s,e] = slot.split('-');
            const th = document.createElement('th');
            th.innerHTML = `${s.padStart(5,'0')}<br>–<br>${e.padStart(5,'0')}`;
            hr.appendChild(th);
          });

          // body rows
          const tbody = tbl.createTBody();
          DAY_ABBR.forEach(d => {
            const row = tbody.insertRow();
            const dayCell = row.insertCell();
            dayCell.textContent = DAY_NAME[d];
            dayCell.style.fontWeight = 'bold';

            slots.forEach(slot => {
              const cell = row.insertCell();
              const raw = (week[d] && week[d][slot]) || [];

              // filter out teacher names / honorifics
              const filtered = raw.filter(tok => !isTeacherToken(tok, teacherTokens));

              // collapse repeated commas/“&” that may be left behind
              const tidy = filtered.join(' ').replace(/\s*&\s*/g,' & ').trim();

              // show each logical chunk on its own line
              cell.innerHTML = tidy
                .split(/\s*,\s*|\s{2,}/)        // split by commas or double-spaces
                .filter(Boolean)
                .map(txt => `<div>${txt}</div>`)
                .join('');
            });
          });

          card.appendChild(tbl);
          CONTAINER.appendChild(card);
        });
      })
      .catch(err => {
        console.error(err);
        CONTAINER.innerHTML =
          `<p style="color:red">Error loading data: ${err.message}</p>`;
      });
  })();
  </script>
</body>
</html>