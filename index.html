<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Teacher Timetables</title>

<style>
  /* ---- basic look --------------------------------------------------- */
  body      { font-family: Arial, Helvetica, sans-serif; margin: 0; background-color: #f4f7f6; }
  section   {
    padding: 20px;
    page-break-after: always;
    background-color: #ffffff;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    max-width: 90%; /* Responsive width */
    overflow-x: auto; /* Enable horizontal scrolling for tables on small screens */
  }
  h2        {
    margin: 0 0 20px; /* Increased margin for better spacing */
    font-size: 1.5rem; /* Larger font size for headers */
    color: #333;
    text-align: center;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 10px;
  }

  table     {
    border-collapse: collapse;
    width: 100%;
    min-width: 700px; /* Ensure table is wide enough for content */
  }
  th, td    {
    border: 1px solid #c9d6df; /* Softer border color */
    padding: 8px 12px; /* Increased padding */
    font-size: 0.85rem; /* Slightly larger font size for readability */
    text-align: center;
    word-wrap: break-word; /* Ensure long words break */
    white-space: normal; /* Allow text to wrap */
    vertical-align: top; /* Align content to the top of the cell */
  }
  th        {
    background: #dbe9f6; /* Lighter blue header */
    color: #3f51b5; /* Darker blue text */
    font-weight: 700;
    position: sticky;
    top: 0;
    z-index: 10; /* Keep headers visible on scroll */
  }
  td        {
    background: #eef5f9; /* Light yellow background */
    color: #4a4a4a;
  }
  td.day    {
    background: #b0d9f4; /* More prominent day column */
    font-weight: 600;
    width: 120px; /* Fixed width for day column */
    text-align: left;
    color: #1a237e; /* Dark blue for day names */
    position: sticky;
    left: 0;
    z-index: 5; /* Keep day column visible on horizontal scroll */
  }
  .rehat-cell { /* Added for styling REHAT cells */
      background-color: #e6ffed !important; /* Light green, !important to override default td bg */
      color: #28a745 !important;
      font-weight: bold;
  }
  /* Responsive adjustments */
  @media (max-width: 768px) {
    section {
      padding: 15px;
      margin: 15px auto;
      max-width: 95%;
    }
    h2 {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    th, td {
      padding: 6px 8px;
      font-size: 0.8rem;
    }
    td.day {
      min-width: 90px; /* Adjust day column width for mobile */
    }
  }

  @media print {
    body { margin: 0; }
    section {
      box-shadow: none;
      border: 1px solid #ccc;
      page-break-after: always; /* Ensure each teacher on a new page */
    }
  }
</style>
</head>
<body>

<div id="root" style="padding:20px; text-align: center;">Loading timetable …</div>

<script>
/* ─────────────────────────── constants ─────────────────────────────── */
const FULL  = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
const ABBR  = ["Mo","Tu","We","Th","Fr"];

// These are the *columns* you want to display in your table.
// The data will be fetched using the *start time* of these ranges.
const DISPLAY_COLUMNS = [ // This defines the columns and their header display
  "07:15-07:45", "07:45-08:15", "08:15-08:45", "08:45-09:15",
  "09:15-09:45", "09:45-10:00", // Represents column for data starting at 09:45
  "10:00-10:30", // Column for data starting at 10:00
  "10:15-10:30", // Column for data starting at 10:15
  "10:30-11:00", "11:00-11:30", "11:30-12:00", "12:00-12:30",
  "12:30-13:00", "13:00-13:30", "13:30-14:00", "14:00-14:30",
  "14:30-15:00", "15:00-15:30"
];
// Note: The original BLOCKS_DISPLAY had overlapping keys like "09:45-10:00" and "09:45-10:15".
// For the new JSON structure, we only need one column for each distinct start time
// where data might exist. The header will display the range.

/* ─────────────────── fetch + main render entry point ───────────────── */
fetch('teacher_schedules.json')
  .then(r => {
    if (!r.ok) {
      throw new Error(`HTTP error! status: ${r.status}`);
    }
    return r.json();
  })
  .then(data => {
    if (data && typeof data === 'object' && data.hasOwnProperty('teachers')) {
      console.log("Found 'teachers' key in JSON, rendering data.teachers.");
      // Pass the actual time keys from the JSON if available for more dynamic data lookup,
      // or continue using DISPLAY_COLUMNS for fixed column structure.
      // For simplicity with the new JSON, we'll use DISPLAY_COLUMNS to define what we show.
      renderAll(data.teachers);
    } else {
      console.error("JSON structure not as expected. Expected 'teachers' key. Top level keys:", Object.keys(data));
      throw new Error("The JSON file structure is not as expected. Expected a 'teachers' object at the root.");
    }
  })
  .catch(err => {
    const root = document.getElementById('root');
    root.innerHTML = `<div style="color: red; font-weight: bold; padding: 20px;">
                        ⚠ Error loading or processing timetable: ${err.message}.<br>
                        Please ensure 'teacher_schedules.json' exists and is a valid JSON with the correct structure.
                      </div>`;
    console.error("Error loading timetable:", err);
  });

function renderAll(teachersDb){
  const root = document.getElementById('root');
  root.innerHTML = ''; 

  if (!teachersDb || typeof teachersDb !== 'object' || Object.keys(teachersDb).length === 0) {
    root.innerHTML = `<div style="color: orange; font-weight: bold; padding: 20px;">
                        ⚠ No teacher data found to render. The 'teachers' object might be empty or missing.
                      </div>`;
    console.warn("renderAll called with no valid teachersDb:", teachersDb);
    return;
  }

  Object.entries(teachersDb).forEach(([name, teacherObj])=>{
      const sec = document.createElement('section');
      sec.innerHTML = `<h2>NAMA GURU: ${name}</h2>`; 
      sec.appendChild(buildTable(teacherObj));
      root.appendChild(sec);
  });
}

function buildTable(t){
  const hasAbbr = ABBR.some(k => t && typeof t === 'object' && k in t); 
  let tbl;

  if (hasAbbr) {
    tbl = fromAbbr(t);
  } else {
    tbl = document.createElement('div');
    tbl.textContent = '⚠ Unrecognised data format for this teacher.';
    tbl.style.color = 'orange';
    tbl.style.fontWeight = 'bold';
    tbl.style.textAlign = 'center';
    tbl.style.padding = '20px';
    console.warn("Unrecognised data format for teacher object:", t);
  }
  return tbl;
}

function headerRow(tbl, columnsToDisplay){ // Changed parameter name for clarity
  const h = tbl.insertRow();
  h.insertCell().outerHTML = '<th>Day</th>';
  columnsToDisplay.forEach(columnRange => {
    const parts = columnRange.split('-');
    const displayTime = `${parts[0]}\n-\n${parts[1]}`;
    h.insertCell().outerHTML = `<th>${displayTime.replace('\n','<br>')}</th>`; 
  });
}

// REVISED fromAbbr function for the new JSON structure
function fromAbbr(teacher){
  const tbl = document.createElement('table');
  headerRow(tbl, DISPLAY_COLUMNS); // Use DISPLAY_COLUMNS for headers

  FULL.forEach((dayName, dIdx) => {
      const tr = tbl.insertRow();
      tr.insertCell().outerHTML = `<td class="day">${dayName}</td>`;
      
      const dayAbbr = ABBR[dIdx];
      const dayData = teacher[dayAbbr] || {}; // e.g., teacher.Mo or teacher.Tu
      
      // console.log(`Processing Day: ${dayAbbr}, Data:`, JSON.parse(JSON.stringify(dayData)));

      DISPLAY_COLUMNS.forEach(columnDisplayRange => { 
          // The key to fetch data from your NEW JSON is the START TIME of the column.
          const startTimeKeyForData = columnDisplayRange.split('-')[0]; // e.g., "07:15"
          
          const cellText = dayData[startTimeKeyForData]; // Fetch using "07:15", "07:45" etc.
          
          // console.log(`  Column: ${columnDisplayRange}, Data Key: ${startTimeKeyForData}, Found Text:`, cellText);

          const td  = tr.insertCell();
          // In your new JSON, cellText is directly a string, not an array.
          if (cellText && typeof cellText === 'string') {
              td.textContent = cellText; 
              if (cellText.toUpperCase().includes("REHAT")) {
                td.classList.add('rehat-cell'); 
              }
          }
          // else: cell remains empty if no data for that startTimeKey
      });
  });
  return tbl;
}

// fromDays and fromRows are likely not needed if this is the only JSON format
function fromDays(blocks, days){ /* ... (kept for completeness, but not used) ... */ return document.createElement('div');}
function fromRows(blocks, rows, titles){ /* ... (kept for completeness, but not used) ... */ return document.createElement('div');}

</script>
</body>
</html>