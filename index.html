<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Teacher Timetables</title>

<style>
  /* ---- basic look --------------------------------------------------- */
  body      { font-family: Arial, Helvetica, sans-serif; margin: 0; background-color: #f4f7f6; }
  section   {
    padding: 20px;
    page-break-after: always;
    background-color: #ffffff;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    max-width: 90%; /* Responsive width */
    overflow-x: auto; /* Enable horizontal scrolling for tables on small screens */
  }
  h2        {
    margin: 0 0 20px; /* Increased margin for better spacing */
    font-size: 1.5rem; /* Larger font size for headers */
    color: #333;
    text-align: center;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 10px;
  }

  table     {
    border-collapse: collapse;
    width: 100%;
    min-width: 700px; /* Ensure table is wide enough for content */
  }
  th, td    {
    border: 1px solid #c9d6df; /* Softer border color */
    padding: 8px 12px; /* Increased padding */
    font-size: 0.85rem; /* Slightly larger font size for readability */
    text-align: center;
    word-wrap: break-word; /* Ensure long words break */
    white-space: normal; /* Allow text to wrap */
  }
  th        {
    background: #dbe9f6; /* Lighter blue header */
    color: #3f51b5; /* Darker blue text */
    font-weight: 700;
    position: sticky;
    top: 0;
    z-index: 10; /* Keep headers visible on scroll */
  }
  td        {
    background: #eef5f9; /* Light yellow background */
    color: #4a4a4a;
  }
  td.day    {
    background: #b0d9f4; /* More prominent day column */
    font-weight: 600;
    width: 120px; /* Fixed width for day column */
    text-align: left;
    color: #1a237e; /* Dark blue for day names */
    position: sticky;
    left: 0;
    z-index: 5; /* Keep day column visible on horizontal scroll */
  }
  /* Responsive adjustments */
  @media (max-width: 768px) {
    section {
      padding: 15px;
      margin: 15px auto;
      max-width: 95%;
    }
    h2 {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    th, td {
      padding: 6px 8px;
      font-size: 0.8rem;
    }
    td.day {
      min-width: 90px; /* Adjust day column width for mobile */
    }
  }

  @media print {
    body { margin: 0; }
    section {
      box-shadow: none;
      border: 1px solid #ccc;
      page-break-after: always; /* Ensure each teacher on a new page */
    }
  }
</style>
</head>
<body>

<div id="root" style="padding:20px; text-align: center;">Loading timetable …</div>

<script>
/* ─────────────────────────── constants ─────────────────────────────── */
const FULL  = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
const ABBR  = ["Mo","Tu","We","Th","Fr"];

// The BLOCKS array represents the display headers (time ranges) for the timetable.
// These ranges will be used to extract the start time for data lookup in the JSON.
const BLOCKS = [
  "07:15-07:45", "07:45-08:15", "08:15-08:45", "08:45-09:15",
  "09:15-09:45", "09:45-10:00", "09:45-10:15", "10:00-10:30",
  "10:15-10:30", "10:30-11:00", "11:00-11:30", "11:30-12:00",
  "12:00-12:30", "12:30-13:00", "13:00-13:30", "13:30-14:00",
  "14:00-14:30", "14:30-15:00", "15:00-15:30"
];

/* ─────────────────── fetch + main render entry point ───────────────── */
// Fetch the JSON data from the specified file
fetch('Json_06.txt') // Changed to 'Json_06.txt' as per user's file
  .then(r => {
    if (!r.ok) {
      throw new Error(`HTTP error! status: ${r.status}`);
    }
    return r.json();
  })
  .then(renderAll)
  .catch(err => {
    // Display error message if fetching or parsing fails
    const root = document.getElementById('root');
    root.innerHTML = `<div style="color: red; font-weight: bold; padding: 20px;">
                        ⚠ Error loading timetable: ${err.message}.<br>
                        Please ensure 'Json_06.txt' exists and is a valid JSON.
                      </div>`;
    console.error("Error loading timetable:", err);
  });

function renderAll(db){
  const root = document.getElementById('root');
  root.innerHTML = ''; // Clear the loading message

  // Iterate over each teacher entry in the JSON database
  Object.entries(db).forEach(([name, teacherObj])=>{
      const sec = document.createElement('section');
      // Create a header for the teacher's name
      sec.innerHTML = `<h2>NAMA GURU: ${name}</h2>`;
      // Build and append the timetable table for the current teacher
      sec.appendChild(buildTable(teacherObj));
      root.appendChild(sec);
  });
}

/* ───────────────── schema-agnostic table builder ───────────────────── */
function buildTable(t){
  /*
  Recognise which layout this teacher uses based on the structure of their data.
  The current JSON ('Json_06.txt') uses the 'abbr' (abbreviated day names like Mo, Tu) schema.
  */
  const hasAbbr = ABBR.some(k => k in t); // Check if any abbreviated day is a top-level key

  let tbl;
  if (hasAbbr) {
    tbl = fromAbbr(t); // Use the function designed for abbreviated day names
  } else {
    // Fallback for unknown schema, providing an error message
    tbl = document.createElement('div');
    tbl.textContent = '⚠ Unrecognised data format for this teacher.';
    tbl.style.color = 'orange';
    tbl.style.fontWeight = 'bold';
    tbl.style.textAlign = 'center';
    tbl.style.padding = '20px';
  }
  return tbl;
}

/* ---------- helpers for the recognised schemas ---------------- */
function headerRow(tbl, blocks){
  const h = tbl.insertRow();
  // First header cell for 'Day'
  h.insertCell().outerHTML = '<th>Day</th>';
  // Create header cells for each time block
  blocks.forEach(b => {
    // 'b' is now a time range string like "07:15-07:45"
    // We want to display the full range in the header.
    h.insertCell().outerHTML = `<th>${b.replace('-', ' - ')}</th>`;
  });
}

function fromAbbr(teacher){
  const tbl = document.createElement('table');
  // Pass the BLOCKS (time ranges for display) to headerRow
  headerRow(tbl, BLOCKS);

  FULL.forEach((dayName, dIdx) => {
      const tr = tbl.insertRow();
      // Add the day name cell
      tr.insertCell().outerHTML = `<td class="day">${dayName}</td>`;
      
      // Iterate through each display block (time range)
      BLOCKS.forEach(blockRange => {
          // Extract the start time from the block range, e.g., "07:15" from "07:15-07:45"
          let startTime = blockRange.split('-')[0];
          
          // Ensure startTime matches the JSON key format (e.g., "07:15" vs "7:15" or "13:00")
          // The Python script is now configured to output HH:MM with leading zeros.
          // So, startTime from BLOCKS should directly match JSON keys.
          
          // Get the data for the current day (e.g., teacher['Mo'])
          const dayData = teacher[ABBR[dIdx]] || {};
          
          // Retrieve the cell content using the formatted start time as the key
          // If the key doesn't exist, cellText will be undefined.
          const cellText = dayData[startTime];
          
          const td  = tr.insertCell();
          // If content exists for this slot, display it. Otherwise, leave cell empty.
          if (cellText) {
              td.textContent = cellText;
          }
      });
  });
  return tbl;
}

// fromDays and fromRows functions are kept for schema compatibility,
// although the current JSON only uses the 'fromAbbr' schema.
function fromDays(blocks, days){
  const tbl = document.createElement('table');
  headerRow(tbl, blocks);

  FULL.forEach(dayName => {
      const tr = tbl.insertRow();
      tr.insertCell().outerHTML = `<td class="day">${dayName}</td>`;
      (days[dayName] || []).forEach(cell=>{
          const td = tr.insertCell();
          if (cell) td.textContent = cell;
      });
  });
  return tbl;
}

function fromRows(blocks, rows, titles){
  const tbl = document.createElement('table');
  headerRow(tbl, blocks);

  // If there are exactly 5 physical rows, assume Mon-Fri order.
  const label = rows.length === 5 ? FULL : titles;

  rows.forEach((row, idx) => {
      const tr = tbl.insertRow();
      tr.insertCell().outerHTML =
          `<td class="day">${label[idx] || 'Row '+(idx+1)}</td>`;
      row.forEach(c=>{
          const td = tr.insertCell();
          if (c) td.textContent = c;
      });
  });
  return tbl;
}
</script>
</body>
</html>